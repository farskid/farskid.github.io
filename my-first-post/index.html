<meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="There are many cases iframe would be good solution to use. Although they are kind of dead to HTML and not a lot of developers use it, It could come up to you as a solution to a complicated problem some day.

" />
    <meta property="og:description" content="There are many cases iframe would be good solution to use. Although they are kind of dead to HTML and not a lot of developers use it, It could come up to you as a solution to a complicated problem some day.

" />
    

    <meta name="author" content="Farzad YZ" />

    
    <meta property="og:title" content="Cross-Domain Iframe-parent communication" />
    <meta property="twitter:title" content="Cross-Domain Iframe-parent communication" />
    
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="/assets/css/style.css"> -->
  
  <title>Farzad YZ personal blog</title>
  <link rel="icon" href="/images/favicon.png">
</head>

<body>
<main class="l-post">

  <section class="post__header" style="background-image: url(https://unsplash.it/1024/768/?random)">
    <a href="/" class="button button--outline button--white button--small button--rounded">&larr; Back</a>
    <section class="post container">
      <h1 class="post__title">
        Cross-Domain Iframe-parent communication
      </h1>
      <date class="post__date post__date--large">28 Dec 2016</date>
    </section>
  </section>

  <section class="post__body">
    <article class="post container">
      <div class="post__entry">
        <p>There are many cases iframe would be good solution to use. Although they are kind of dead to HTML and not a lot of developers use it, It could come up to you as a solution to a complicated problem some day.</p>

<p>Knowing a way to communicate through iframe to parent is such a valuable and time saver. Maybe iframe could tell it’s parents when it’s content is ready or engage user interactions inside iframe with the parent to react properly.
Some days ago at my company we had a Wordpress website that loaded an iframe for choosing a plan to buy virtual machines as shown below.</p>

<!-- ![An iframe included inside Wordpress to choose VM plans
]("https://cdn-images-1.medium.com/max/1600/1*Npna_TbF8ChgAroSVkyu_Q.png" An iframe included inside Wordpress to choose VM plans) -->

<p>I was assigned a task to do something challenging on this element. The company intended to open a URL on click of the orange button, BUT because the button was inside the iframe, that couldn’t be managed easily.
First thing I tried to was to use postMessage to send a message from iframe to it’s parent. I came up with this code:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"Path/To/Html"</span><span class="nt">&gt;&lt;button</span> <span class="na">id=</span><span class="s">"my-btn"</span><span class="nt">&gt;</span>Start<span class="nt">&lt;/button&gt;&lt;/iframe&gt;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-btn'</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">handleButtonClick</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="kd">function</span> <span class="nx">handleButtonClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="s1">'iframe_message'</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And also listen to the message on the parent window:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'iframe_message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">'some url'</span><span class="p">,</span> <span class="s1">'_blank'</span><span class="p">)</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">)</span>
</code></pre></div></div>

<p>It was perfect! worked like a charm. It passed some minutes until I figured out the actual problem. This only worked for same-domain iframes. Apparently cross-domain iframes don’t post message to the parent properly.</p>

<p>I dogged the web a lot and found a really interesting inspiration on a dark edge of stackoverflow . Although It did not help me, It fixed me on the right direction. The solution was to use customEvents.</p>

<p>So I refactored the solution to:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'my-btn'</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="nx">handleButtonClick</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">myEvent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CustomEvent</span><span class="p">(</span><span class="s1">'my_event'</span><span class="p">,</span> <span class="p">{</span> <span class="na">detail</span><span class="p">:</span> <span class="p">{</span><span class="na">url</span><span class="p">:</span> <span class="s1">'some url'</span><span class="p">}</span> <span class="p">});</span>

<span class="kd">function</span> <span class="nx">handleButtonClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">myEvent</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And listen to it on the parent of course:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'iframe_message'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">detail</span><span class="p">.</span><span class="nx">url</span>
  <span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="s1">'_blank'</span><span class="p">)</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">)</span>
</code></pre></div></div>

<p>It was amazing as I could easily pass custom data from iframe to the parent window.</p>

<h2 id="conclusion">Conclusion:</h2>

<p>Dealing with iframes is Hard. It’s not intended to be used unless there is no other way to do it.
If you’re using a same-domain iframe, you’re in heaven. You could easily control iframe’s content and also communicate to it’s parent through postMessage.</p>

<p>But you’re in Hell when it gets cross-domain. You could only use CustomEvent and dispatchEvent on the iframe and listen to it on the parent window. In this case try to modularize your communication protocol and pass custom data.</p>

      </div>
    </article>
  </section>

</main>

<div class="container">
  <div class="row post__siblings">
    
    
      <a class="button button--outline" href="/Manage-and-Promisify-async-actions-in-javascript/">Manage and Promisify async actions in javascript &rarr;</a>
    
  </div>
</div>

<section class="post__footer container">
  <div class="row">
    <div class="col--3 text--center">
      <div class="hero__avatar avatar avatar--circle"></div>
    </div>
    <div class="col--9">
      <h3 class="post__footer__title">Farzad YZ</h3>
      <p class="post__footer__entry">
        Javascript enthusiast, blogger, astronomer
      </p>
      <a href="/about" class="button button--fill button--small button--rounded">More about me</a>
    </div>
  </div>
</section>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104117544-1', 'auto');
  ga('send', 'pageview');

</script>
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Open Sans Condensed:300,300italic,700', 'Merriweather:300,300italic,400,italic,700,700italic', 'Open Sans:300,300italic,400,italic,600,600italic,700,700italic', 'Overpass Mono']
    }
  });

</script>
 <script src="/assets/site-1778c2a687e031eca121a38276054984eee6654585660db2bff6a212665d5341.js" type="text/javascript"></script>
</body>

</html>