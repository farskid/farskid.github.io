<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>

<body>
    <header>
        <img src="/assets/feri.jpg" alt="Farzad Yousefzadeh" />
        <h1>Farzad Yousefzadeh</h1>
        <nav>
            <ul>
                <li><a href="/">About</a></li>
                <li><a href="/cv">CV</a></li>
                <li><a href="/talks">Talks</a></li>
                <li><a href="/blog">Blog</a></li>
            </ul>
            <a>Follow @farzad_yz on Twitter</a>
        </nav>
    </header>
    <link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@10.5.0/styles/atom-one-dark.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Serif:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans',
                sans-serif;
        }
    
        pre,
        code {
            font-family: 'IBM Plex Mono',
                monospace;
        }
    
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'IBM Plex Serif',
        }
    </style>    <main>
        <h1>Cross-Domain Iframe-parent communication</h1>
        <p
            style="font-size: 0.87055rem; line-height: 1.5rem; display: block; margin-bottom: 1.5rem; margin-top: -1.5rem;">
            2016-12-28</p>
        <article><p>There are many cases iframe would be good solution to use. Although they are kind of dead to HTML and not a lot of developers use it, It could come up to you as a solution to a complicated problem some day.</p>
<p>Knowing a way to communicate through iframe to parent is such a valuable and time saver. Maybe iframe could tell it’s parents when it’s content is ready or engage user interactions inside iframe with the parent to react properly.</p>
<p>Some days ago at my company we had a Wordpress website that loaded an iframe for choosing a plan to buy virtual machines as shown below.</p>
<p><img src="https://cdn-images-1.medium.com/max/1600/1*Npna_TbF8ChgAroSVkyu_Q.png" alt="An iframe included inside Wordpress to choose VM plans"></p>
<p>I was assigned a task to do something challenging on this element. The company intended to open a URL on click of the orange button, BUT because the button was inside the iframe, that couldn’t be managed easily.</p>
<p>First thing I tried to was to use postMessage to send a message from iframe to it’s parent. I came up with this code:</p>
<pre><code class="hljs language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;Path/To/Html&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;my-btn&quot;</span>&gt;</span>Start<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-js"><span class="hljs-built_in">document</span>
  .getElementById(<span class="hljs-string">&quot;my-btn&quot;</span>)
  .addEventListener(<span class="hljs-string">&quot;click&quot;</span>, handleButtonClick, <span class="hljs-literal">false</span>);
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleButtonClick</span>(<span class="hljs-params">e</span>) </span>{
  <span class="hljs-built_in">window</span>.parent.postMessage(<span class="hljs-string">&quot;iframe_message&quot;</span>);
}
</code></pre>
<p>And also listen to the message on the parent window:</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">&#x27;iframe_message&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-built_in">window</span>.open(<span class="hljs-string">&#x27;some url&#x27;</span>, <span class="hljs-string">&#x27;\_blank&#x27;</span>)
}, <span class="hljs-literal">false</span>
</code></pre>
<p>It was perfect! worked like a charm. It passed some minutes until I figured out the actual problem. <strong>This only worked for same-domain iframes</strong>. Apparently <strong>cross-domain iframes don’t post message to the parent properly</strong>.</p>
<p>I dogged the web a lot and found a really interesting inspiration on a dark edge of <a href="https://stackoverflow.com/">stackoverflow</a> . Although It did not help me, It fixed me on the right direction. The solution was to use customEvents.</p>
<p>So I refactored the solution to:</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">document</span>
  .getElementById(<span class="hljs-string">&quot;my-btn&quot;</span>)
  .addEventListener(<span class="hljs-string">&quot;click&quot;</span>, handleButtonClick, <span class="hljs-literal">false</span>);
<span class="hljs-keyword">var</span> myEvent = <span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">&quot;my_event&quot;</span>, { <span class="hljs-attr">detail</span>: { <span class="hljs-attr">url</span>: <span class="hljs-string">&quot;some url&quot;</span> } });
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleButtonClick</span>(<span class="hljs-params">e</span>) </span>{
  <span class="hljs-built_in">window</span>.parent.dispatchEvent(myEvent);
}
</code></pre>
<p>And listen to it on the parent of course:</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">window</span>.addEventListener(
  <span class="hljs-string">&quot;iframe_message&quot;</span>,
  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> url = e.detail.url;
    <span class="hljs-built_in">window</span>.open(url, <span class="hljs-string">&quot;_blank&quot;</span>);
  },
  <span class="hljs-literal">false</span>
);
</code></pre>
<p>It was amazing as I could easily pass custom data from iframe to the parent window.</p>
<h2>Conclusion:</h2>
<p>Dealing with iframes is Hard. It’s not intended to be used unless there is no other way to do it.</p>
<p>If you’re using a same-domain iframe, you’re in heaven. You could easily control iframe’s content and also communicate to it’s parent through postMessage.</p>
<p>But you’re in Hell when it gets cross-domain. You could only use CustomEvent and dispatchEvent on the iframe and listen to it on the parent window. In this case try to modularize your communication protocol and pass custom data.</p>
</article>
        <footer>
            Next Post: <a href="/blog/Detecting-unique-arrays-in-Javascript">Detecting-unique-arrays-in-Javascript</a>
            Prev Post: <a href="/blog/3-Ways-to-clone-objects-in-Javascript">3-Ways-to-clone-objects-in-Javascript</a>
        </footer>
    </main>
    <footer class="footer">
        <p>The materials of this website are licensed under<a target="_blank"
                href="https://creativecommons.org/licenses/by-nc/2.0/"
                style="margin-left: 0.375rem; display: inline-block;">The
                Creative Commons</a></p>
        <p>Farzad Yousefzadeh @2021</p>
    </footer></body>

</html>