<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
</head>

<body>
    <header>
        <img src="/assets/feri.jpg" alt="Farzad Yousefzadeh" />
        <h1>Farzad Yousefzadeh</h1>
        <nav>
            <ul>
                <li><a href="/">About</a></li>
                <li><a href="/cv">CV</a></li>
                <li><a href="/talks">Talks</a></li>
                <li><a href="/blog">Blog</a></li>
            </ul>
            <a>Follow @farzad_yz on Twitter</a>
        </nav>
    </header>
    <link rel="stylesheet" href="//unpkg.com/@highlightjs/cdn-assets@10.5.0/styles/atom-one-dark.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400&family=IBM+Plex+Sans:ital,wght@0,400;0,700;1,400&family=IBM+Plex+Serif:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'IBM Plex Sans',
                sans-serif;
        }
    
        pre,
        code {
            font-family: 'IBM Plex Mono',
                monospace;
        }
    
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: 'IBM Plex Serif',
        }
    </style>    <main>
        <h1>useBackButton hook to handle back button behavior in React Native</h1>
        <p
            style="font-size: 0.87055rem; line-height: 1.5rem; display: block; margin-bottom: 1.5rem; margin-top: -1.5rem;">
            2019-08-12</p>
        <article><p><a href="https://reactjs.org/docs/hooks-intro.html">React hooks</a> help with carrying stateful logic and keeping their lifecycle separate from the view layer lifecycle. They've been around since React v16.8 and since people have been avoiding class components in favor of hooks.</p>
<p>One of the somewhat interesting aspects of hooks is their flexibility in terms of composition and abstraction. If a code snippet using different <a href="https://reactjs.org/docs/hooks-reference.html">built-in hooks</a> is handling a part of logic that is separate and independent from other parts, it can be abstracted away as a <a href="https://reactjs.org/docs/hooks-custom.html"><strong>Custom Hook</strong></a>.</p>
<h2>useBackButton custom hook</h2>
<p>To handle the behavior of hardware back button in Android and tvOS devices using React Native, there is <a href="https://facebook.github.io/react-native/docs/backhandler.html"><em>BackHandler</em></a> API that can assist in overriding the default behavior or patching it.</p>
<p><code>BackHandler</code> takes an event-driven approach to offer an API, meaning that to subscribe to back button presses, you'll need to register an event listener.</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { BackHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-native&quot;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">backButtonHandler</span>(<span class="hljs-params"></span>) </span>{}

BackHandler.addEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, backButtonHandler);
</code></pre>
<p>and of course, to de-register this subscription, you'll need to use <code>removeListener</code>, the same way we do so handling DOM events.</p>
<pre><code class="hljs language-js">backButtonHandler.removeEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, backButtonHandler);
</code></pre>
<h3>use Hooks to utilize BackHandler</h3>
<p>Subscriptions are side effects! therefore, we can use <code>useEffect</code> built-in hook to execute them. It's important to notice that <code>useEffect</code> requires us to return a function to remove the subscription once React is willing to clean up! Cleanups are usual when the component is being unmounted or one of the dependencies of the <code>useEffect</code> hook change, so React needs to clean up previous subscriptions of that hook and re-execute it!</p>
<p><a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup">Read more about subscriptions and cleanups in <em>useEffect</em></a></p>
<pre><code class="hljs language-jsx"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">backButtonHandler</span>(<span class="hljs-params"></span>) </span>{}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MyComponent</span>(<span class="hljs-params"></span>) </span>{
  useEffect(<span class="hljs-function">() =&gt;</span> {
    BackHandler.addEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, backButtonHandler);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      BackHandler.removeEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, backButtonHandler);
    };
  }, [backButtonHandler]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>...<span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>;
}
</code></pre>
<h3>useBackButton is born!</h3>
<p>while the above code snippet works perfectly, copy-pasting it into all the screens might sound frustrating to some of us (we're freaks after all)! To help to remove our frustrations, React offers a way to build your custom hook.</p>
<pre><code class="hljs language-jsx"><span class="hljs-comment">/* ComponentA */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">backButtonHandlerForA</span>(<span class="hljs-params"></span>) </span>{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentA</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Frustration begins!</span>
  useEffect(<span class="hljs-function">() =&gt;</span> {
    BackHandler.addEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, backButtonHandlerForA);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      BackHandler.removeEventListener(
        <span class="hljs-string">&quot;hardwareBackPress&quot;</span>,
        backButtonHandlerForA
      );
    };
  }, [backButtonHandlerForA]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ViewA</span> /&gt;</span></span>;
}

<span class="hljs-comment">/* ComponentB */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">backButtonHandlerForB</span>(<span class="hljs-params"></span>) </span>{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentB</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Frustration begins!</span>
  useEffect(<span class="hljs-function">() =&gt;</span> {
    BackHandler.addEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, backButtonHandlerForB);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      BackHandler.removeEventListener(
        <span class="hljs-string">&quot;hardwareBackPress&quot;</span>,
        backButtonHandlerForB
      );
    };
  }, [backButtonHandlerForB]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ViewB</span> /&gt;</span></span>;
}
</code></pre>
<p>A custom hook is just an abstraction to share the same logic between components and hooks, the same way we do this between functions in a regular programming.
Components are functions. Hooks are functions as well. You get the idea, right?!</p>
<p>In cases of <em>ComponentA</em> and <em>ComponentB</em> samples above, registration, removal and hook implementation are the same. it's just the handlers that can be different per component. So our custom hook needs to provide those common parts and only accept the changing part (handler per component) as an incoming argument.</p>
<pre><code class="hljs language-jsx"><span class="hljs-comment">/* highlight-start */</span>
<span class="hljs-comment">/* useBackButton */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">useBackButton</span>(<span class="hljs-params">handler</span>) </span>{
  <span class="hljs-comment">// Frustration isolated! Yay! ðŸŽ‰</span>
  useEffect(<span class="hljs-function">() =&gt;</span> {
    BackHandler.addEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, handler);

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      BackHandler.removeEventListener(<span class="hljs-string">&quot;hardwareBackPress&quot;</span>, handler);
    };
  }, [handler]);
}
<span class="hljs-comment">/* highlight-end */</span>

<span class="hljs-comment">/* ComponentA */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">backButtonHandlerForA</span>(<span class="hljs-params"></span>) </span>{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentA</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// utilize custom hook</span>
  useBackButtton(backButtonHandlerForA);
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ViewA</span> /&gt;</span></span>;
}

<span class="hljs-comment">/* ComponentB */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">backButtonHandlerForB</span>(<span class="hljs-params"></span>) </span>{}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentB</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// utilize custom hook</span>
  useBackButtton(backButtonHandlerForB);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ViewB</span> /&gt;</span></span>;
}
</code></pre>
<h2>Recap</h2>
<p>If you intend to share a common logic between components and built-in hooks, you can abstract that away by building your custom hook. Make sure to read the impressively detailed docs of Hooks and <strong>Rules of Hooks</strong> from the official docs.</p>
<p>Cheers!</p>
</article>
        <footer>
            Prev Post: <a href="/blog/Unit-Testing-Higher-Order-Components-with-Enzyme-and-Jest">Unit-Testing-Higher-Order-Components-with-Enzyme-and-Jest</a>
        </footer>
    </main>
    <footer class="footer">
        <p>The materials of this website are licensed under<a target="_blank"
                href="https://creativecommons.org/licenses/by-nc/2.0/"
                style="margin-left: 0.375rem; display: inline-block;">The
                Creative Commons</a></p>
        <p>Farzad Yousefzadeh @2021</p>
    </footer></body>

</html>