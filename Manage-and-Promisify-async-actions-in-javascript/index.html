<meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Javascript is different from other languages. Programmers from other languages once entering the javascript era might get confused easily but the action is not true on the reverse side. One of the easy to get yet hard to implement and maintain task in Javascript is to perform an async task.
To asynchronously run a task in Javascript, Developers have 3 different options.

" />
    <meta property="og:description" content="Javascript is different from other languages. Programmers from other languages once entering the javascript era might get confused easily but the action is not true on the reverse side. One of the easy to get yet hard to implement and maintain task in Javascript is to perform an async task.
To asynchronously run a task in Javascript, Developers have 3 different options.

" />
    

    <meta name="author" content="Farzad YZ" />

    
    <meta property="og:title" content="Manage and Promisify async actions in javascript" />
    <meta property="twitter:title" content="Manage and Promisify async actions in javascript" />
    
<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="/assets/css/style.css"> -->
  
  <title>Farzad YZ personal blog</title>
  <link rel="icon" href="/images/favicon.png">
</head>

<body>
<main class="l-post">

  <section class="post__header" style="background-image: url(https://unsplash.it/1024/768/?random)">
    <a href="/" class="button button--outline button--white button--small button--rounded">&larr; Back</a>
    <section class="post container">
      <h1 class="post__title">
        Manage and Promisify async actions in javascript
      </h1>
      <date class="post__date post__date--large">22 Jan 2017</date>
    </section>
  </section>

  <section class="post__body">
    <article class="post container">
      <div class="post__entry">
        <p>Javascript is different from other languages. Programmers from other languages once entering the javascript era might get confused easily but the action is not true on the reverse side. One of the easy to get yet hard to implement and maintain task in Javascript is to perform an async task.
To asynchronously run a task in Javascript, Developers have 3 different options.</p>

<ol>
  <li>Callbacks (ES5)</li>
  <li>Promises (ES6)</li>
  <li>Async / Await (ES7: still draft)</li>
</ol>

<p>In this article we are going to cover the first 2 options yet leaving the third one to the audience, probably lots of snippets and great articles could be found about it around the internet.</p>

<h2 id="asynchronous-task">Asynchronous Task</h2>

<p>An asynchronous task is a task that’s not going to return value as soon as it’s called, the timestamp between calling the async task and returning the value is unknown and dependant to many factors.</p>

<h2 id="callback">Callback</h2>

<p>To control the returning value from our async task and working with it, our first and the hardest to maintain and chain, would be callbacks. Callbacks are first class functions passed to the async function as an argument.
Let’s assume our async function is just a setTimeout that returns a random integer.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">myAsyncTask</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>And also assume that we are going to control the returned value by multiplying by 2.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">controller</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To pass controller to the async function, it should accept an argument:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">myAsyncTask</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">())</span>
  <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we pass the controller to the async function to see what happens!</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">myAsyncTask</span><span class="p">(</span><span class="nx">controller</span><span class="p">)</span>
</code></pre></div></div>

<p>This will alert double of the random input after 1 seconds. Give it a try!
As you see, callbacks are nice BUT, what if we wanna do multiple async tasks altogether? what if we wanna share code snippets and function in nested callback calls? Nested callbacks are typically HELL. I mean it. In fact they are so hard to maintain that in Node JS, since all tasks are asynchronous, the tasks should be called nested and you’ll simply end up with multiple (easily up to 5 steps) nested callbacks inside each other.
This problem led the dev community into requesting other tools to manage these kind of functions and the tool was called PROMISE.</p>

<h2 id="promise">Promise</h2>

<p>Promise came to make dev lives easier. promises are often hard to understand. Once I saw above infographic about a weather forecast example and how it can be converted to promise concept (originally from Andy Shora Blog), I finally grasped the concept.</p>

<p>Promises are like, hey code snippet, promise me to do this async task, if your returned value fulfills this condition, resolve the value else reject it.</p>

<p>Every promise has a resolve and reject function that are relatively success and error of task. Promises are like try-catch` blocks. You could chain promises infinite times but pass the errors down to the single bottom catch.
The resolve function is used inside a .thenmethod and the reject in .catch
Let’s rewrite our fake async task in promise manner!</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">myAsyncTask</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rand</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">rand</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">rand</span><span class="p">)</span>
    <span class="k">else</span> <span class="nx">reject</span><span class="p">(</span><span class="nx">rand</span><span class="p">)</span>
   <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
  <span class="p">})</span>
 <span class="p">}</span>
<span class="kd">function</span> <span class="nx">resolveController</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">'Value greater than 0.5 is :'</span> <span class="o">+</span> <span class="nx">input</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">rejectController</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s1">'Value less that 0.5 is : '</span> <span class="o">+</span> <span class="nx">input</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now since the resolve function is <code class="highlighter-rouge">resolveController</code> and reject function is <code class="highlighter-rouge">rejectController</code>, use resolveController inside <code class="highlighter-rouge">.then</code> and rejectController inside <code class="highlighter-rouge">.catch</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">myAsyncTask</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">resolveController</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="nx">rejectController</span><span class="p">)</span>
</code></pre></div></div>

<p>The code is now better read, better understood and much easier to chain and maintain.</p>

<h2 id="last-attack">Last Attack</h2>

<p>As appeared in title of this article, promisify is the process of converting a callback based procedure into promise. It’s actually simple and useful for some reasons.</p>

<ol>
  <li>It’s luxury :-P</li>
  <li>It’s modern javascript and more up-to-dated
3.It’s better to read and look at</li>
  <li>Many async tasks such as reading and writing to fileSystem, Ajax request, Connecting to and querying on database,… are present inside a real world javascript application and you gotta get out from the callback hell ASAP</li>
</ol>

<p>So how do we convert a callback hell to a promise paradise? It’s freakingly easy. Just parallel convert success callbacks and error callbacks into resolve and reject respectively.</p>

<p>Consider below jQuery ajax request:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getDataFromServer</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">fail</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">getJson</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">success</span><span class="p">,</span> <span class="nx">fail</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">getUsersByCallback</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">getDataFromServer</span><span class="p">(</span><span class="s1">'https://myrestapi.com/users'</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Yesss, I got users'</span><span class="p">)</span>
  <span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Bummer, could not get users right now'</span><span class="p">)</span>
  <span class="p">})</span>
 <span class="p">}</span>
</code></pre></div></div>

<p>Once converted into promise, would look like:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getDataFromServer</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">$</span><span class="p">.</span><span class="nx">getJson</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>      <span class="p">{</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">response</span><span class="p">)},</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span><span class="nx">reject</span><span class="p">(</span><span class="nx">error</span><span class="p">)})</span>
  <span class="p">})</span>
 <span class="p">}</span>
 <span class="kd">function</span> <span class="nx">getUsersByPromise</span><span class="p">()</span> <span class="p">{</span>
 <span class="nx">getDataFromServer</span><span class="p">(</span><span class="s1">'https://myrestapi.com/users'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'Yesss, I got users'</span><span class="p">)</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Bummer, could not get users right now'</span><span class="p">)</span>
  <span class="p">})</span>
 <span class="p">}</span>
</code></pre></div></div>

<p>That easy!!!!</p>

<h2 id="conclusion">Conclusion</h2>

<p>Async tasks are everywhere even outside of javascript and every language provides stable methods and tools to deal with them. In javascript callbacks, promises and async/awaits are available as solutions. As you saw, async/await is still a draft but has been implemented in recent versions of Babel transpiler so you could give it a try but don’t get used to it to much as it could vanish like in seconds.</p>

<p>Promisify your async tasks with the technique discussed in the article and you’re good to go further than working inside a callback hell.</p>

      </div>
    </article>
  </section>

</main>

<div class="container">
  <div class="row post__siblings">
    
      <a class="button button--outline" href="/my-first-post/">&larr; Cross-Domain Iframe-parent communication</a>
    
    
      <a class="button button--outline" href="/Hide-browser-default-metas-on-print/">Hide browsers's default metadata when printing a webpage &rarr;</a>
    
  </div>
</div>

<section class="post__footer container">
  <div class="row">
    <div class="col--3 text--center">
      <div class="hero__avatar avatar avatar--circle"></div>
    </div>
    <div class="col--9">
      <h3 class="post__footer__title">Farzad YZ</h3>
      <p class="post__footer__entry">
        Javascript enthusiast, blogger, astronomer
      </p>
      <a href="/about" class="button button--fill button--small button--rounded">More about me</a>
    </div>
  </div>
</section>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104117544-1', 'auto');
  ga('send', 'pageview');

</script>
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Open Sans Condensed:300,300italic,700', 'Merriweather:300,300italic,400,italic,700,700italic', 'Open Sans:300,300italic,400,italic,600,600italic,700,700italic', 'Overpass Mono']
    }
  });

</script>
 <script src="/assets/site-1778c2a687e031eca121a38276054984eee6654585660db2bff6a212665d5341.js" type="text/javascript"></script>
</body>

</html>